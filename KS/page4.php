<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>4</title>
    <style>
       *{
            margin: 0;
            padding: 0;
            font-weight: bold;
            font-size: 37px;
        }
        #new1{
        		width: 325px;
            height: 79px;
            position: relative;
            top: 96px;
            left: 30px;
            background: none;
            text-align: center;
        }
        #new2{
        		width: 345px;
            height: 79px;
            position: relative;
            top: 96px;
            left: 41px;
            background: none;
            text-align: center;
        }
        
        #ft1{
            width: 119px;
            height: 78px;
            position: relative;
            top: 177px;
            right: 579px;
            background: none;
            text-align: center;
            font-size:30px;
        }
        #ft2{
            width: 119px;
            height: 78px;
            position: relative;
            top: 179px;
            right: 587px;
            background: none;
            text-align: center;
            
        }
        #ft3{
            width: 119px;
            height: 78px;
            position: relative;
            top: 260px;
            right: 840px;
            background: none;
            text-align: center;
            font-size:30px;
        }
        #ft4{
            width: 119px;
            height: 78px;
            position: relative;
            top: 262px;
            right: 847px;
            background: none;
            text-align: center;
        }

        #rt1{
            width: 83px;
            height: 79px;
            position: relative;
            top: 174px;
            right: 836px;
            background: none;
            text-align: center;
        }
        #rt2{
            width: 83px;
            height: 79px;
            position: relative;
            top: 174px;
            right: 843px;
            background: none;
            text-align: center;
        }
        #rt3{
            width: 83px;
            height: 79px;
            position: relative;
            top: 175px;
            right: 850px;
            background: none;
            text-align: center;
        }
        #rt4{
            width: 83px;
            height: 79px;
            position: relative;
            top: 175px;
            right: 857px;
            background: none;
            text-align: center;
        }
				#rt5{
            width: 83px;
            height: 79px;
            position: relative;
            top: 257px;
            right: 1213px;
            background: none;
            text-align: center;
        }
        #rt6{
            width: 83px;
            height: 79px;
            position: relative;
            top: 257px;
            right: 1220px;
            background: none;
            text-align: center;
        }
        #rt7{
            width: 83px;
            height: 79px;
            position: relative;
            top: 257px;
            right: 1227px;
            background: none;
            text-align: center;
        }
        #rt8{
            width: 83px;
            height: 79px;
            position: relative;
            top: 167px;
            left: 639px;
            background: none;
            text-align: center;
        }
				
        #tt3{
            width: 378px;
            height: 79px;
            position: relative;
            top: 93px;
            left: 650px;
            background: none;
            text-align: center;
            font-size:50px;
        }
        #tt4{
            width: 378px;
            height: 79px;
            position: relative;
            top: 93px;
            left: 644px;
            background: none;
            text-align: center;
            font-size:50px;
        }
        #tt5{
            width: 378px;
            height: 79px;
            position: relative;
            top: 93px;
            left: 638px;
            background: none;
            text-align: center;
            font-size:50px;
        }

        #fm1{
            width: 100px;
            height: 89px;
            position: relative;
            top: 376px;
            right: 1232px;
            background: none;
            text-align: center;
        }
        #fm2{
            width: 144px;
            height: 89px;
            position: relative;
            top: 376px;
            right: 1239px;
            background: none;
            text-align: center;
        }
        #fm3{
            width: 144px;
            height: 89px;
            position: relative;
            top: 376px;
            right: 1246px;
            background: none;
            text-align: center;
        }
        #fm4{
            width: 144px;
            height: 89px;
            position: relative;
            top: 376px;
            right: 1254px;
            background: none;
            text-align: center;
        }
        #fm5{
            width: 144px;
            height: 89px;
            position: relative;
            top: 276px;
            left: 578px;
            background: none;
            text-align: center;
        }

        #sm1{
            width: 164px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 589px;
            background: none;
            text-align: center;
            font-size:50px;
        }
        #sm2{
            width: 219px;
            height: 99px;
            position: relative;
            top: 175px;
            left: 582px;
            background: none;
            text-align: center;
            font-size:30px;
        }
        #sm3{
            width: 151px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 574px;
            background: none;
            text-align: center;
            font-size:50px;          
        }
        #sm4{
            width: 124px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 567px;
            background: none;
            text-align: center;      
            font-size:45px;     
        }
        #sm5{
            width: 154px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 560px;
            background: none;
            text-align: center;     
            font-size:50px;      
        }
        #sm6{
            width: 154px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 553px;;
            background: none;
            text-align: center;     
            font-size:50px;      
        }
        #sm7{
            width: 154px;
            height: 99px;
            position: relative;
            top: 181px;
            left: 545px;;
            background: none;
            text-align: center;    
            font-size:50px;         
        }
        #sm8{
            width: 219px;
            height: 89px;
            position: relative;
            top: 280px;
            right: 442px;;
            background: none;
            text-align: center;    
            font-size:50px;  
        }
        #sm9{
            width: 100px;
            height: 50px;
            position: relative;
            top: 118px;
            left:150px;
            background: none;
            text-align: center;        
            border: none;
            
        }
				input{text-align:center; border:1px solid lightgray;			
					}
        td,th{
            border: 1px solid black;
        }
        tr{
        	height:70px;
        }      
        .table-container {
				     text-align: center;
            position: relative;
            top: 27px;
            right: 583px;
            width: 692px;
            height: 421px;
            background-color: white;
            margin: auto;
            border: 1px solid black;
            overflow: auto;
				}
				 #btable{
            background-color: white;
            width:100%;
            border-collapse: collapse;
        }
        #btable1{
            background-color: white;
            width:100%;
            border-collapse: collapse;
        }
        .table-container2 {
				    text-align: center;
            position: relative;
            bottom: 395px;
            left: 358px;
            width: 1145px;
            height: 421px;
            background-color: white;
            margin: auto;
            border: 1px solid black;
            overflow: auto;
				}
				#new1,#new2{color:white;}
				
				#mb9{
        		width: 150px;
            height: 44px;
            position: relative;
            bottom: 31px;
            left:1430px;
            background: none;
            border:none;
            font-size:50px; 
        	}
				
				.progress-bar {
            background-color: #ececec;
            box-shadow: inset 0 0.5em 0.5em rgba(0,0,0,0.05);
            height: 90px;
            margin: 2rem 0 2rem 0;
            overflow: hidden;
            position: relative;
            transform: translateZ(0);
            width: 39.4%;
            top:104px;
            left:1135px;
           
        }

        .progress-bar__bar {
            background-color: #09B864;
            box-shadow: inset 0 0.5em 0.5em rgba(94, 49, 49, 0.05);
            bottom: 0;
            left: 0;
            right: 0; /* 수정된 부분: right 속성 추가 */
            position: absolute;
            top: 0;
            transition: width 500ms ease-out; /* width만 트랜지션하도록 수정 */
        }

        .progress-bar__bar.active {
            width: 100%; /* active 클래스에서 바로 100%로 설정 */
        }
					#popupbtn{
			    width: 325px;
			    height: 70px;
			    background: none;
			    position: fixed;
			    top: 22px;
			    left: 30px;
			    cursor: pointer;
			}
    </style>
    <script src="popup.js"></script>
 
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="steakerPage" style="background:url(steaker.jpg); width: 1920px; height: 1080px;">
        <!--팝업창-->
        <div id="popupbtn"></div>
        <div id="popup" style="display: none;">
            <span id="x">X</span>
            <br>
            <br>
            <div id="popinput">
                <label for="ip" style="font-size:20px;">I&nbsp;&nbsp;&nbsp;&nbsp;P :</label>
                <input type="text" id="ip" style="font-size:20px;">
                <br>
           		  <br>
                <label for="pgselect" style="font-size:20px;">PAGE :</label>
                <select id="pgselect" style="font-size:20px;">
                    <option value="1">생산모니터링</option>
                    <option value="3">보드투입</option>
                    <option value="4">스테커</option>
                </select>
                <br>
                <br>
                <button type="button" id="ok" style="font-size:20px;">OK</button>
            </div>
        </div>
				
				<input type="text" id="new1"  readonly>
        <input type="text" id="new2"  readonly>
        <!--제품 종류-->
        <input type="text" id="ft1"  readonly>
        <input type="text" id="ft2"  readonly>
        <input type="text" id="ft3"  readonly>
        <input type="text" id="ft4"  readonly>
        <!--내장재 종류-->
        <input type="text" id="rt1" style="font-size:25px;"readonly>
        <input type="text" id="rt2" style="font-size:25px;" readonly>
        <input type="text" id="rt3" style="font-size:25px;" readonly>
        <input type="text" id="rt4" style="font-size:25px;" readonly>
        <input type="text" id="rt5" style="font-size:25px;" readonly>
        <input type="text" id="rt6" style="font-size:25px;" readonly>
        <input type="text" id="rt7" style="font-size:25px;" readonly>
        <input type="text" id="rt8" style="font-size:25px;" readonly>
        <!--생산현황-->
      
        <input type="text" id="tt3"  readonly>
        <input type="text" id="tt4"  readonly>
        <input type="text" id="tt5"  readonly>
        <!--현작번~번완수-->
        <input type="text" id="fm1"  readonly>
        <input type="text" id="fm2"  readonly>
        <input type="text" id="fm3"  readonly>
        <input type="text" id="fm4"  readonly>
        <input type="text" id="fm5"  readonly>
        <!--현작번~현재길이-->
        <input type="text" id="sm1" readonly>
        <input type="text" id="sm2" readonly>
        <input type="text" id="sm3" readonly>
        <input type="text" id="sm4" readonly>
        <input type="text" id="sm5" readonly>
        <input type="text" id="sm6" readonly>
        <input type="text" id="sm7" readonly>
        <input type="text" id="sm8" readonly>
				
        
        <div class="progress-bar">
		        <div class="progress-bar__bar"></div>
		    </div>
        <!--table1-->
         <input type="text" id="mb9" readonly>
        <div class="table-container">
        <table class="table" id="btable">
                  <colgroup>
                    <col width="10%">
                    <col width="22%">
                    <col width="22%">
                    <col width="22%">
                    <col width="22%">     
                </colgroup>
                <thead id="bthead1">
                	<tr height=45px;>
                		<th style="font-size:28px;">번호</th>
                		<th style="font-size:28px;"> &nbsp &nbsp &nbsp 적재 &nbsp &nbsp &nbsp 설정수량</th>
                		<th style="font-size:28px;"> &nbsp &nbsp &nbsp 적재 &nbsp &nbsp &nbsp 완료수량</th>
                    <th style="font-size:28px;"> &nbsp &nbsp &nbsp 번들 &nbsp &nbsp &nbsp 설정수량</th>
                		<th style="font-size:28px;"> &nbsp &nbsp &nbsp 번들  &nbsp &nbsp &nbsp 완료수량</th>
                	</tr>
                </thead>
                <tbody id="tbody1">
                    
                </tbody>
            </table>
      </div>
      
        <div class="table-container2">
        	<!--table2-->
        <table class="table" id="btable1">
                <colgroup>
                    <col width="7%">
                    <col width="22%">
                    <col width="12%">
                    <col width="18%">
                    <col width="12%">
                    <col width="12%">
                    <col width="18%">
                    
                </colgroup>
                <thead id="bthead">
                	<tr height=45px;>
                		<th style="font-size:28px;">번호</th>
                		<th style="font-size:28px;">업체명</th>
                    <th style="font-size:28px;">두께</th>
                		<th style="font-size:28px;">길이</th>
                		<th style="font-size:28px;">계획수량</th>
                		<th style="font-size:28px;">생산수량</th>
                		<th style="font-size:28px;">생산량</th>	
                	</tr>
                </thead>
                <tbody id="tbody2">
                    
                </tbody>
            </table>
      </div>
           <script>
         var previousMb1Value = 1;
        const progressBarElem = document.querySelector('.progress-bar__bar');
   function getdata2(no) {
    // 이전에 적용한 색상 초기화
    $('#rt1, #rt2, #rt3, #rt4').css('background-color', '');

    $.ajax({
        url: 'table2.php?_=' + new Date().getTime(),
        type: 'GET',
        data: { nwno: no },
        success: function(response) {
            console.log('Data received from table2.php:', response);

            // 추가된 디버깅
            try {
                var jsonData = JSON.parse(response);
                console.log('Parsed JSON data:', jsonData);
            } catch (e) {
                console.error('Error parsing JSON data:', e);
            }

            if (jsonData && jsonData.inser_num) {
                if (jsonData.inser_num == '48K ') {
                    $('#rt1').css('background-color', 'red');
                } else if (jsonData.inser_num == '64K ') {
                    $('#rt2').css('background-color', 'red');
                } else if (jsonData.inser_num == '일반 ') {
                    $('#rt3').css('background-color', 'red');
                } else if (jsonData.inser_num == '난연 ') {
                    $('#rt4').css('background-color', 'red');
                } else {
                    console.error('Invalid inser_num value:', jsonData.inser_num);
                }
            } else {
                console.error('Invalid JSON format or missing "inser_num" property.');
            }
        },
        error: function(error) {
            console.error('AJAX Error:', error);
        }
    });
}     
         	 
         	 
    function loadTableData(mb1Value) {
        const $tbody = $('#tbody1');
        $tbody.empty();
        $.ajax({
            url: 'table6.php',
            type: 'GET',
            dataType: 'json',
            data: { nwno: mb1Value },
            success: function(data) {
                $.each(data, function(index, item) {
                    var row = `
                        <tr>
                            <td>${item.load_num}</td>
                            <td>${item.load_num1}</td>
                            <td>${item.load_num2}</td>
                            <td>${item.load_num3}</td>
                            <td>${item.load_num4}</td>
                        </tr>
                    `;
                    $tbody.append(row);
                });
            }
        });
    }
		function loadTableData2(mb1Value) {
        const $tbody = $('#tbody2');
        $tbody.empty();
        $.ajax({
            url: 'table.php',
            type: 'GET',
            dataType: 'json',
            data: { nwno: mb1Value },
            success: function(data) {
                $.each(data, function(index, item) {
                    var row = `
                        <tr>
                            <td>${item.num_ta}</td>
                            <td>${item.comp_name}</td>        
                            <td>${item.jepum_dug}</td>
                            <td>${item.jepum_len}</td>
                            <td>${item.jepum_num}</td>
                            <td>${item.seang_num}</td>
                            <td>${item.seang_len}</td> 
                        </tr>
                    `;
                    $tbody.append(row);
                });
            }
        });
    }
 function getdata3(mb1Value) {
    $.ajax({
        url: 'startData2.php',
        type: 'GET',
        dataType: 'json',
        data: { nwno: mb1Value },
        success: function(data) {
            $('#fm2').val(data.load_num1);
            $('#fm3').val(data.load_num2);
            $('#fm4').val(data.load_num3);
            $('#fm5').val(data.load_num4);
        },
        error: function(err) {
            console.log(err);
        }
    });
}
    
    function getdata() {
        $.ajax({
            url: 'startData.php',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                // PHP에서 가져온 데이터를 사용하여 웹 페이지 업데이트
                $('#ft1').val(data.cs1);
            $('#ft2').val(data.cs2);
            $('#ft3').val(data.ch1);
            $('#ft4').val(data.ch2);
            
            $('#st1').val(data.k48);
            $('#st2').val(data.k64);
            $('#st3').val(data.cnomal);
            $('#st4').val(data.cny);
            
            $('#tt1').val(data.mstart);
            $('#tt2').val(data.mend);
            $('#tt3').val(data.tml);
            $('#tt4').val(data.nml);
            $('#tt5').val(data.lml);
	            
	          $('#fm1').val(data.nwno);  
	          
	          
	          $('#sm1').val(data.nwno);
	          $('#sm2').val(data.nwcname);
	          $('#sm3').val(data.nwcode);
	          $('#sm4').val(data.nwt);
	          $('#sm5').val(data.nwsl);
	          $('#sm6').val(data.nwsc);
	          $('#sm7').val(data.nwc);
	          $('#sm8').val(data.nwl);
	          $('#new1').val(data.jpjr);
						$('#new2').val(data.njjr);
						
						const targetLength = data.nwsl; // 설정 길이
						const currentLength = data.nwl; // 현재 길이
						
						// targetLength 또는 currentLength이 NaN이면 기본값 0으로 처리
						const target = isNaN(targetLength) ? 0 : targetLength;
						const current = isNaN(currentLength) ? 0 : currentLength;
						
						const percentage = (current / target) * 100;
						
						progressBarElem.style.width = `${percentage}%`;
						progressBarElem.classList.add('active');
						
						if (isNaN(percentage)) {
						    $('#mb9').val('0%');
						} else {
						    $('#mb9').val(Math.floor(percentage) + '%');
						}
						
						$.ajax({
										url:'table4.php',
										type:'GET',
										dataType:'json',
										success:function(res){
												$('#rt1').val(res[0].je_dug);
												$('#rt2').val(res[1].je_dug);
												$('#rt3').val(res[2].je_dug);
												$('#rt4').val(res[3].je_dug);
												$('#rt5').val(res[4].je_dug);
												$('#rt6').val(res[5].je_dug);
												$('#rt7').val(res[6].je_dug);
												$('#rt8').val(res[7].je_dug);
												
											},
											error:function(err){console.log(err);}
									});
						
               
								if (previousMb1Value !== data.nwno) {
		                // 처음에는 previousMb1Value가 초기값이므로 getdata2 실행
		                if (previousMb1Value !== null) {
		                    getdata2(data.nwno);     
		                }
											getdata3(data.nwno);
		                loadTableData(data.nwno);
		                loadTableData2(data.nwno);
		            }
								
							
                previousMb1Value = data.nwno;
            },
            error: function(err) {
                console.log(err);
            }
        });
    }
function loadUrlFromFile() {
    // Android에서 JavaScript 함수 호출하여 값 가져오기
    var urlValue = AndroidBridge.getUrlValue();
    console.log("Received URL Value from Android: " + urlValue);

    // 가져온 값을 $('#ip') 엘리먼트의 값으로 설정
    $('#ip').val(urlValue);

    // 여기에서 필요한 작업 수행
}

    $(document).ready(function() {
        // 페이지 로드 시 한 번 실행
        loadTableData(previousMb1Value);
				loadTableData2(previousMb1Value);
				loadUrlFromFile();
        // 페이지 로드 시 데이터 업데이트 시작
        getdata();
        setInterval(getdata, 1000);
    });
</script>
    </div>
</body>
</html>